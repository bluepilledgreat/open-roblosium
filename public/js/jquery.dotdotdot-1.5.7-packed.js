(function(n){function l(n,i,r){var e=n.children(),s=!1,u,o,f;for(n.empty(),u=0,o=e.length;o>u;u++){if(f=e.eq(u),n.append(f),r&&n.append(r),t(n,i)){f.remove(),s=!0;break}r&&r.remove()}return s}function e(i,r,u,f,o){var v=i.contents(),s=!1,h,l;i.empty();for(var y="table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, select, optgroup, option, textarea, script, style",a=0,p=v.length;p>a&&!s;a++)h=v[a],l=n(h),void 0!==h&&(i.append(l),o&&i[i.is(y)?"after":"append"](o),3==h.nodeType?t(u,f)&&(s=c(l,r,u,f,o)):s=e(l,r,u,f,o),s||o&&o.remove());return s}function c(n,i,u,f,e){var y=!1,o=n[0],k,a,b,tt,p;if(o===void 0)return!1;for(var d="letter"==f.wrap?"":" ",v=s(o).split(d),w=-1,l=-1,g=0,nt=v.length-1;nt>=g;){if(k=Math.floor((g+nt)/2),k==l)break;l=k,r(o,v.slice(0,l+1).join(d)+f.ellipsis),t(u,f)?nt=l:(w=l,g=l)}return-1==w||1==v.length&&0==v[0].length?(a=n.parent(),n.remove(),b=e?e.length:0,a.contents().size()>b?(tt=a.contents().eq(-1-b),y=c(tt,i,u,f,e)):(o=a.prev().contents().eq(-1)[0],o!==void 0&&(p=h(s(o),f),r(o,p),a.remove(),y=!0))):(p=h(v.slice(0,w+1).join(d),f),y=!0,r(o,p)),y}function t(n,t){return n.innerHeight()>t.maxHeight}function h(t,i){for(;n.inArray(t.slice(-1),i.lastCharacter.remove)>-1;)t=t.slice(0,-1);return 0>n.inArray(t.slice(-1),i.lastCharacter.noEllipsis)&&(t+=i.ellipsis),t}function i(n){return{width:n.innerWidth(),height:n.innerHeight()}}function r(n,t){n.innerText?n.innerText=t:n.nodeValue?n.nodeValue=t:n.textContent&&(n.textContent=t)}function s(n){return n.innerText?n.innerText:n.nodeValue?n.nodeValue:n.textContent?n.textContent:""}function a(t,i){return t===void 0?!1:t?"string"==typeof t?(t=n(t,i),t.length?t:!1):"object"==typeof t?t.jquery===void 0?!1:t:!1:!1}function v(n){for(var t,u=n.innerHeight(),r=["paddingTop","paddingBottom"],i=0,f=r.length;f>i;i++)t=parseInt(n.css(r[i]),10),isNaN(t)&&(t=0),u-=t;return u}function y(n,t){return n?(t="string"==typeof t?"dotdotdot: "+t:["dotdotdot:",t],window.console!==void 0&&window.console.log!==void 0&&window.console.log(t),!1):!1}var o,f,u;n.fn.dotdotdot||(n.fn.dotdotdot=function(r){var u;if(0==this.length)return r&&r.debug===!1||y(!0,'No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){n(this).dotdotdot(r)});u=this,u.data("dotdotdot")&&u.trigger("destroy.dot"),u.bind_events=function(){return u.bind("update.dot",function(i,r){i.preventDefault(),i.stopPropagation(),f.maxHeight="number"==typeof f.height?f.height:v(u),f.maxHeight+=f.tolerance,r!==void 0&&(("string"==typeof r||r instanceof HTMLElement)&&(r=n("<div />").append(r).contents()),r instanceof n&&(p=r)),h=u.wrapInner('<div class="dotdotdot" />').children(),h.empty().append(p.clone(!0)).css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var c=!1,o=!1;return s.afterElement&&(c=s.afterElement.clone(!0),s.afterElement.remove()),t(h,f)&&(o="children"==f.wrap?l(h,f,c):e(h,u,h,f,c)),h.replaceWith(h.contents()),h=null,n.isFunction(f.callback)&&f.callback.call(u[0],o,p),s.isTruncated=o,o}).bind("isTruncated.dot",function(n,t){return n.preventDefault(),n.stopPropagation(),"function"==typeof t&&t.call(u[0],s.isTruncated),s.isTruncated}).bind("originalContent.dot",function(n,t){return n.preventDefault(),n.stopPropagation(),"function"==typeof t&&t.call(u[0],p),p}).bind("destroy.dot",function(n){n.preventDefault(),n.stopPropagation(),u.unwatch().unbind_events().empty().append(p).data("dotdotdot",!1)}),u},u.unbind_events=function(){return u.unbind(".dot"),u},u.watch=function(){if(u.unwatch(),"window"==f.watch){var t=n(window),e=t.width(),r=t.height();t.bind("resize.dot"+s.dotId,function(){e==t.width()&&r==t.height()&&f.windowResizeFix||(e=t.width(),r=t.height(),c&&clearInterval(c),c=setTimeout(function(){u.trigger("update.dot")},10))})}else w=i(u),c=setInterval(function(){var n=i(u);(w.width!=n.width||w.height!=n.height)&&(u.trigger("update.dot"),w=i(u))},100);return u},u.unwatch=function(){return n(window).unbind("resize.dot"+s.dotId),c&&clearInterval(c),u};var p=u.contents(),f=n.extend(!0,{},n.fn.dotdotdot.defaults,r),s={},w={},c=null,h=null;return s.afterElement=a(f.after,u),s.isTruncated=!1,s.dotId=o++,u.data("dotdotdot",!0).bind_events().trigger("update.dot"),f.watch&&u.watch(),u},n.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",lastCharacter:{remove:[" ",",",";",".","!","?"],noEllipsis:[]},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0,debug:!1},o=1,f=n.fn.html,n.fn.html=function(n){return n!==void 0?this.data("dotdotdot")&&"function"!=typeof n?this.trigger("update",[n]):f.call(this,n):f.call(this)},u=n.fn.text,n.fn.text=function(t){if(t!==void 0){if(this.data("dotdotdot")){var i=n("<div />");return i.text(t),t=i.html(),i.remove(),this.trigger("update",[t])}return u.call(this,t)}return u.call(this)})})(jQuery);